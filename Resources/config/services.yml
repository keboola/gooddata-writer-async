parameters:

services:
  gooddata_writer.app_configuration:
    class: Keboola\GoodDataWriter\Writer\AppConfiguration
    arguments: [%app_name%, %storage_api.url%, %gooddata_writer%]
  gooddata_writer.gooddata_model:
    class: Keboola\GoodDataWriter\GoodData\Model
    arguments: [@gooddata_writer.app_configuration]

  gooddata_writer.rest_api.s3_client:
    class: Keboola\GoodDataWriter\Service\S3Client
    arguments: [@gooddata_writer.app_configuration, "RestAPI"]
  gooddata_writer.rest_api.log_formatter:
    class: Keboola\GoodDataWriter\Service\RestAPILogFormatter
    arguments: [@gooddata_writer.rest_api.s3_client]
  gooddata_writer.rest_api.syslog_handler:
    class: Monolog\Handler\SyslogHandler
    arguments: [%app_name%]
  gooddata_writer.rest_api.logger_configurator:
    class: Keboola\GoodDataWriter\GoodData\RestApiLoggerConfigurator
    arguments: [@gooddata_writer.rest_api.syslog_handler, @gooddata_writer.rest_api.log_formatter]
  gooddata_writer.rest_api.logger:
    class: Monolog\Logger
    arguments: ["restApi"]
    configurator: ["@gooddata_writer.rest_api.logger_configurator", configure]
  gooddata_writer.rest_api:
    class: Keboola\GoodDataWriter\GoodData\RestApi
    arguments: [@gooddata_writer.gooddata_model, @logger, @gooddata_writer.rest_api.logger, @syrup.temp_factory]

  gooddata_writer.shared_config:
    class: Keboola\GoodDataWriter\Writer\SharedConfig
    arguments: [@gooddata_writer.app_configuration, @syrup.encryptor_factory]

  gooddata_writer.invitations_handler:
      class: Keboola\GoodDataWriter\GoodData\InvitationsHandler
      arguments: [@gooddata_writer.app_configuration, @gooddata_writer.shared_config]

  gooddata_writer.job_executor:
    class: Keboola\GoodDataWriter\Writer\JobExecutor
    arguments: [@gooddata_writer.app_configuration, @gooddata_writer.shared_config, @gooddata_writer.rest_api, @logger, @syrup.temp_factory, @gooddata_writer.jobs_queue, @translator]

  gooddata_writer.jobs_queue:
    class: Keboola\GoodDataWriter\Service\Queue
    arguments: [@gooddata_writer.app_configuration]